%!TEX TS-program = lualatex
\documentclass{article}
\usepackage{luacode}
\usepackage[safe]{tipa}
\usepackage{amsmath,amssymb,amsthm}
\usepackage[english,french]{babel}
\babelfont{rm}{DejaVu Serif}
\usepackage{forloop}
\usepackage{fontawesome5}
\usepackage{tabularray}
\usepackage{enumitem}
\usepackage{ninecolors}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{subfiles}
\makeatletter
\newcounter{my@stars}
\newcommand{\stars}[1]{%
  \forloop{my@stars}{0}{\value{my@stars}<#1}{%
    \faStar%
  }%
}
\makeatother
\renewcommand{\implies}{\Rightarrow}
\begin{luacode*}
  local phonetics = {
  A = { tipa = "A", conceal = "ð˜¢", tirg = "a" },
  E = { tipa = "E", conceal = "É›" },
  I = { tipa = "I", conceal = "Éª" },
  N = { tipa = "N", conceal = "Å‹", trig = "n" },
  O = { tipa = "O", conceal = "É”", trig = "o" },
  S = { tipa = "S", conceal = "Êƒ", trig = "s" },
  T = { tipa = "T", conceal = "Î¸", trig = "st" },
  U = { tipa = "U", conceal = "ÊŠ", trig = "u" },
  Z = { tipa = "Z", conceal = "Ê’", trig = "r" },
  ["2"] = { tipa = "2", conceal = "á´§", trig = "a" },
  ["3"] = { tipa = "3", conceal = "Éœ", trig = "e" },
  [":"] = { tipa = ":", conceal = "Ë" },
  ["@"] = { tipa = "@", conceal = "É™", trig = "e" },
  ['"'] = { tipa = '""', conceal = "ËŒ" },
  ["'"] = { tipa = '"', conceal = "Ëˆ" },
  a = { tipa = "a", conceal = "ð–º" },
  b = { tipa = "b", conceal = "b" },
  c = { tipa = "c", conceal = "c" },
  d = { tipa = "d", conceal = "d" },
  e = { tipa = "e", conceal = "e" },
  f = { tipa = "f", conceal = "f" },
  g = { tipa = "g", conceal = "É¡" },
  h = { tipa = "h", conceal = "h" },
  i = { tipa = "i", conceal = "i" },
  j = { tipa = "j", conceal = "j" },
  k = { tipa = "k", conceal = "k" },
  l = { tipa = "l", conceal = "l" },
  m = { tipa = "m", conceal = "m" },
  n = { tipa = "n", conceal = "n" },
  o = { tipa = "3", conceal = "Éœ", trig = "e" },
  p = { tipa = "p", conceal = "p" },
  q = { tipa = "\\dh ", conceal = "Ã°", trig = "zs" },
  r = { tipa = "r", conceal = "r" },
  s = { tipa = "s", conceal = "s" },
  t = { tipa = "t", conceal = "t" },
  u = { tipa = "u", conceal = "u" },
  v = { tipa = "v", conceal = "v" },
  w = { tipa = "w", conceal = "w" },
  x = { tipa = "\\ae ", conceal = "á´‚", trig = "a" },
  y = { tipa = "2", conceal = "á´§", trig = "a" },
  z = { tipa = "z", conceal = "z" },
  }
  local fphone = {
  A = { tipa = "A", conceal = "ð˜¢", tirg = "a" },
  E = { tipa = "E", conceal = "É›" },
  I = { tipa = "I", conceal = "Éª" },
  N = { tipa = "\\textltailn ", conceal = "É²", trig = "n" },
  O = { tipa = "O", conceal = "É”", trig = "o" },
  Q = { tipa = "\\o ", conceal = "Ã¸", trig = "o" },
  S = { tipa = "S", conceal = "Êƒ", trig = "s" },
  U = { tipa = "U", conceal = "ÊŠ", trig = "u" },
  X = { tipa = "\\~\\oe ", conceal = "Å’", trig = "o" },
  Y = { tipa = "\\textlhtlongy ", conceal = "É¥", trig = "y" },
  Z = { tipa = "Z", conceal = "Ê’", trig = "r" },
  ["0"] = { tipa = "\\~O", conceal = "O", trig = "o" },
  ["3"] = { tipa = "\\~E", conceal = "E", trig = "e" },
  [":"] = { tipa = ":", conceal = "Ë" },
  ["@"] = { tipa = "@", conceal = "É™", trig = "e" },
  ['"'] = { tipa = '""', conceal = "ËŒ" },
  ["'"] = { tipa = '"', conceal = "Ëˆ" },
  a = { tipa = "a", conceal = "ð–º" },
  b = { tipa = "b", conceal = "b" },
  c = { tipa = "c", conceal = "c" },
  d = { tipa = "d", conceal = "d" },
  e = { tipa = "e", conceal = "e" },
  f = { tipa = "f", conceal = "f" },
  g = { tipa = "g", conceal = "É¡" },
  h = { tipa = "h", conceal = "h" },
  i = { tipa = "i", conceal = "i" },
  j = { tipa = "j", conceal = "j" },
  k = { tipa = "k", conceal = "k" },
  l = { tipa = "l", conceal = "l" },
  m = { tipa = "m", conceal = "m" },
  n = { tipa = "n", conceal = "n" },
  o = { tipa = "o", conceal = "o" },
  p = { tipa = "p", conceal = "p" },
  q = { tipa = "\\~a", conceal = "Ã£", trig = "a" },
  r = { tipa = "K", conceal = "Ê" },
  s = { tipa = "s", conceal = "s" },
  t = { tipa = "t", conceal = "t" },
  u = { tipa = "u", conceal = "u" },
  v = { tipa = "v", conceal = "v" },
  w = { tipa = "w", conceal = "w" },
  x = { tipa = "\\oe ", conceal = "Å“", trig = "o" },
  y = { tipa = "y", conceal = "y" },
  z = { tipa = "z", conceal = "z" },
  }
  function TIPA(str)
  local result = "\\textipa{/"
    for letter in str:gmatch(".") do
    result = result .. phonetics[letter].tipa
    end
    result = result .. "/}"
  tex.print(result)
  end
  function FTIPA(str)
  local result = "\\textipa{/"
    for letter in str:gmatch(".") do
    result = result .. fphone[letter].tipa
    end
    result = result .. "/}"
  tex.print(result)
  end
\end{luacode*}
\newcommand{\mytipa}[1]{\directlua{TIPA([[#1]])}}
\newcommand{\myftipa}[1]{\directlua{FTIPA([[#1]])}}
%environment setting
\newcounter{word}
\newenvironment{word}[3]{\par\refstepcounter{word}\noindent\theword. \textbf{#1} #2\hfill \stars{#3}}{\vspace{0.4cm}}
\newcounter{sentence}
\newenvironment{sentence}{\par\refstepcounter{sentence}\noindent \textbf{sentence} \thesentence. \par}{\vspace{0.4cm}}
\newcounter{grammar}
\newenvironment{grammar}[1]{\par\refstepcounter{grammar}\noindent \textbf{Grammar focus} \thegrammar. \textbf{#1}\par}{}
\newcounter{article}
\newenvironment{article}[1]{\par\refstepcounter{article}\noindent \textbf{Article}\begin{center}\large\bf #1\end{center}\par}{\vspace{0.4cm}}
\newcounter{pronuciation}
\newenvironment{pronuciation}{\par\refstepcounter{pronuciation}\noindent \textbf{pronuciation} \thepronuciation. \par}{\vspace{0.4cm}}
\newcounter{practice}
\newenvironment{practice}{\par\refstepcounter{practice}\noindent \textbf{practice} \thepractice.}{\vspace{0.4cm}}
\newenvironment{french}{}{}

%emphysize
\newif\ifink
% \inktrue
\ifink
  \renewcommand{\color}[1]{\bf}
  \newgeometry{left=0.5cm,right=0.5cm,top=0.5cm,bottom=0.5cm}
\fi
\newcommand{\emword}[2][]{\expandafter\hyperref[#1]{{\color{red}#2}}}
\newcommand{\emsent}[2][]{\expandafter\hyperref[#1]{\underline{#2}}}
\newcommand{\mytextcolor}[2]{\textcolor{#1}{#2}}
\DefTblrTemplate{conthead-text}{fanblue}{(Continuer)}
\DefTblrTemplate{contfoot-text}{fanblue}{(WyyLoveByl)}
\DefTblrTemplate{middlehead}{fanblue}{(Following above page)}
\DefTblrTemplate{caption-tag}{fanblue}{TTTTTableeeee\hspace{0.25em}\Roman{table}}
\DefTblrTemplate{caption-sep}{fanblue}{\(\overset{d}{=}\)}
\DefTblrTemplate{caption-text}{fanblue}{\InsertTblrText{caption}}
\DefTblrTemplate{note-tag}{fanblue}{\textsuperscript{\InsertTblrNoteTag}}
%BUG:THis can't work
%\DefTblrTemplate{note-sep}{default}{\space}
\DefTblrTemplate{note-text}{fanblue}{\qquad\InsertTblrNoteText}
\DefTblrTemplate{remark-tag}{fanblue}{\InsertTblrRemarkTag}
\DefTblrTemplate{remark-sep}{fanblue}{\myftipa{x}}
\DefTblrTemplate{remark-text}{fanblue}{\InsertTblrRemarkText}
\NewTblrTheme{fanblue}{
  \SetTblrTemplate{conthead-text}{fanblue}
  \SetTblrTemplate{contfoot-text}{fanblue}
  \SetTblrTemplate{caption-tag}{fanblue}
  \SetTblrStyle{firsthead}{font=\bfseries\Huge,fg=green2}
  \SetTblrStyle{firstfoot}{fg=red2}
  \SetTblrStyle{middlefoot}{\itshape}
  \SetTblrStyle{middlehead}{font=\bfseries\small,fg=purple3,halign=c}
  \SetTblrStyle{caption-tag}{red2}
}
\begin{document}

\end{document}

